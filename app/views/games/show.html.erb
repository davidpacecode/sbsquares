<p style="color: green"><%= notice %></p>
<p style="color: red"><%= alert %></p>

<div class="wa-stack" style="max-width: 900px; margin: 0 auto;">
  <div class="wa-cluster wa-align-items-center">
    <%= image_tag @game.team_1_logo, alt: @game.team_1, width: 50 if @game.team_1_logo.attached? %>
    <h1><%= "#{@game.team_1} vs. #{@game.team_2}" %></h1>
    <%= image_tag @game.team_2_logo, alt: @game.team_2, width: 50 if @game.team_2_logo.attached? %>
  </div>
</div>

<br />

<turbo-frame id="score_board">
  <%= render "scoreboard", game: @game %>
  <%= tag.br %>
  <%= render "winners", game: @game if @game.is_locked? %>
</turbo-frame>
<br />

<strong><%= "\$#{@game.square_price} per square" %></strong>
<br />
<br />

<turbo-frame id="squares_grid">
  <%= button_to "Randomize Numbers", randomize_numbers_game_path(@game), method: :patch if Current.user.root? %>

  <br />

  <strong><%= "You currently owe \$#{@current_total_cost}" %></strong>
  <br />
  <br />

  <%= form_with url: claim_squares_game_path(@game), method: :patch do |f| %>
    <div class="wa-stack" style="max-width: 800px; width: 100%;">
      <div class="wa-grid wa-gap-2xs" style="--min-column-size: 1rem;">
        <div style="border: 2px solid #ccc; padding: 0px; text-align: center; min-height: 5px; justify-content: center; align-items: center; border-radius: 4px; <%= 'background-color: #f0f0f0;' %>">
          <%= "#{@game.team_2.first}#{@game.team_1.first}" %>
        </div>
        <% (0..9).each do |x| %>
          <div style="border: 2px solid #ccc; padding: 0px; text-align: center; min-height: 5px; justify-content: center; align-items: center; border-radius: 4px; <%= 'background-color: #f0f0f0;' %>">
            <%= @game.team_1_numbers[x] %>
          </div>
        <% end %>
      </div>
      <% @game.squares.order(:row, :column).each do |square| %>
        <% if square.column == 0 %>
          <div class="wa-grid wa-gap-2xs" style="--min-column-size: 2rem;">
            <div style="border: 2px solid #ccc; padding: 0px; text-align: center; min-height: 5px; justify-content: center; align-items: center; border-radius: 4px; <%= 'background-color: #f0f0f0;' %>">
              <%= @game.team_2_numbers[square.row] %> 
            </div>
        <% end %>
        <div style="border: 2px solid #ccc; padding: 0px; text-align: center; min-height: 5px; justify-content: center; align-items: center; border-radius: 4px; <%= 'background-color: #f0f0f0;' if square.user.present? %>">
          <% if square.user.present? %>
            <strong style="font-size: 0.8em; margin-top: 2px;"><%= square.user.initials %></strong>
          <% elsif authenticated? %>
            <%= check_box_tag 'square_ids[]', square.id, false, id: "square_#{square.id}", style: "transform: scale(1); margin-top: 4px;" %>
          <% else %>
            <span style="color: #999; font-size: 0.85em;">Available</span>
          <% end %>
        </div>
        <% if square.column == 9 %>
          </div>
        <% end %>
      <% end %>
    </div>

    <% if authenticated? %>
      <div style="text-align: center; margin: 20px 0;">
        <%= f.submit "Claim Selected Squares", class: "wa-button", style: "padding: 12px 24px; font-size: 1.1em;" unless @game.is_locked? %>
      </div>
    <% else %>
      <div style="text-align: center; margin: 20px 0;">
        <p>Please <%= link_to "log in", new_session_path %> to claim squares.</p>
      </div>
    <% end %>
  <% end %>
</turbo-frame>

<div>
  <%= link_to "Edit this game", edit_game_path(@game) if Current.user.root? %>
  <%= link_to "Back to games", games_path %>

  <%= button_to "Destroy this game", @game, method: :delete if Current.user.root? %>
</div>


